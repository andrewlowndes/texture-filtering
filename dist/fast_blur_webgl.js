(()=>{"use strict";var e={851:function(e,r,t){var n=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(r,"__esModule",{value:!0});const o=t(787),i=t(278),a=t(601),l=t(372),u=t(549),c=t(795),m=n(t(467)),d=n(t(803)),s=document.getElementById("game"),x=document.getElementById("image"),f=document.getElementById("amount"),g=document.getElementById("amountvalue"),v=document.getElementById("timetaken"),C=s.getContext("webgl2");if(!C)throw new Error("No WebGL2 Support :(");let h,_=8;const E=()=>{const e=a.makeLogScale(0,512);C.clearColor(0,0,0,0);const r=u.loadShader(C,m.default,C.VERTEX_SHADER),t=u.loadShader(C,d.default,C.FRAGMENT_SHADER),n=c.createProgram(C,r,t),s=C.createVertexArray();if(null===s)throw new Error("Could not create screen triangle");C.bindVertexArray(s);const E=C.createBuffer();C.bindBuffer(C.ARRAY_BUFFER,E),C.bufferData(C.ARRAY_BUFFER,new Float32Array([-1,-1,3,-1,-1,3]),C.STATIC_DRAW);const p=C.createTexture();if(C.bindTexture(C.TEXTURE_2D,p),C.pixelStorei(C.UNPACK_FLIP_Y_WEBGL,!0),C.texImage2D(C.TEXTURE_2D,0,C.RGBA,C.RGBA,C.UNSIGNED_BYTE,x),C.generateMipmap(C.TEXTURE_2D),x.width*x.height>16777216)throw new Error("Image too big, up to 4096 x 4096 supported");const T=i.createSummedTextureWebgl(l.getImageData(x)),y=C.createTexture();C.bindTexture(C.TEXTURE_2D,y),C.texImage2D(C.TEXTURE_2D,0,C.RGBA32UI,x.width,x.height,0,C.RGBA_INTEGER,C.UNSIGNED_INT,T),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MAG_FILTER,C.NEAREST),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_MIN_FILTER,C.NEAREST),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_S,C.CLAMP_TO_EDGE),C.texParameteri(C.TEXTURE_2D,C.TEXTURE_WRAP_T,C.CLAMP_TO_EDGE),C.useProgram(n);const D=C.getAttribLocation(n,"a_position");C.bindBuffer(C.ARRAY_BUFFER,E),C.enableVertexAttribArray(D),C.vertexAttribPointer(D,2,C.FLOAT,!1,0,0);const A=C.getUniformLocation(n,"u_texture");C.uniform1i(A,0),C.activeTexture(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,p),h=C.getUniformLocation(n,"u_bluramount");const R=C.getUniformLocation(n,"u_summedtexture");C.uniform1i(R,1),C.activeTexture(C.TEXTURE1),C.bindTexture(C.TEXTURE_2D,y);const w=o.createRenderer((()=>{g.value=_.toString(),f.value=e.toLinear(_).toString(),((e,r)=>{const t=Date.now();C.viewport(0,0,C.canvas.width,C.canvas.height),C.clear(C.COLOR_BUFFER_BIT|C.DEPTH_BUFFER_BIT),C.useProgram(e),C.uniform1f(h,_),C.bindVertexArray(r),C.drawArrays(C.TRIANGLES,0,3),v.innerText=Date.now()-t+" ms"})(n,s)}));f.oninput=()=>{_=parseFloat(e.fromLinear(parseFloat(f.value)).toFixed(1)),w()},g.onchange=()=>{_=parseFloat(g.value),w()},w()};x.complete?E():x.onload=E},787:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createRenderer=void 0,r.createRenderer=(e,r)=>{let t=!1;return()=>{t||(t=!0,requestAnimationFrame((()=>{e(),t=!1,null==r||r()})))}}},278:(e,r,t)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createSummedTextureWebgl=void 0;const n=t(78),o=t(196);r.createSummedTextureWebgl=e=>{const r=new Array(e.height);for(let t=0;t<e.height;t++){r[t]=new Array(e.width);for(let i=0;i<e.width;i++){const a=4*((e.height-1-t)*e.width+i),l=new Uint32Array(e.data.slice(a,a+4));i>0&&n.add4Mutate(l,r[t][i-1]),t>0&&n.add4Mutate(l,r[t-1][i]),i>0&&t>0&&o.subtract4Mutate(l,r[t-1][i-1]),r[t][i]=l}}const t=new Uint32Array(e.width*e.height*4);for(let n=0,o=e.height-1;o>=0;o--){const i=r[o];for(let r=0;r<e.width;r++,n+=4){const e=i[r];t[n]=e[0],t[n+1]=e[1],t[n+2]=e[2],t[n+3]=e[3]}}return t}},601:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.makeLogScale=void 0,r.makeLogScale=(e,r)=>{const t=e?Math.log(e):0,n=Math.log(r)-t;return{fromLinear:e=>Math.exp(t+n*e),toLinear:e=>(Math.log(e)-t)/n}}},78:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.add4Mutate=void 0,r.add4Mutate=(e,r)=>(e[0]+=r[0],e[1]+=r[1],e[2]+=r[2],e[3]+=r[3],e)},372:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.getImageData=void 0,r.getImageData=e=>{const r=document.createElement("canvas");r.width=e.width,r.height=e.height;const t=r.getContext("2d");if(!t)throw new Error("Could not create canvas to extract image data");return t.clearRect(0,0,r.width,r.height),t.drawImage(e,0,0),t.getImageData(0,0,r.width,r.height)}},196:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.subtract4Mutate=void 0,r.subtract4Mutate=(e,r)=>(e[0]-=r[0],e[1]-=r[1],e[2]-=r[2],e[3]-=r[3],e)},795:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.createProgram=void 0,r.createProgram=(e,r,t)=>{const n=e.createProgram();if(null===n)throw new Error("Could not create program");if(e.attachShader(n,r),e.attachShader(n,t),e.linkProgram(n),!e.getProgramParameter(n,e.LINK_STATUS)){const r=e.getProgramInfoLog(n);throw e.deleteProgram(n),new Error(`Error linking program : ${r}`)}return n}},549:(e,r)=>{Object.defineProperty(r,"__esModule",{value:!0}),r.loadShader=void 0,r.loadShader=(e,r,t)=>{const n=e.createShader(t);if(null===n)throw new Error("Could not create shader");if(e.shaderSource(n,r),e.compileShader(n),!e.getShaderParameter(n,e.COMPILE_STATUS)){const r=e.getShaderInfoLog(n);throw e.deleteShader(n),new Error(`Error compiling shader: ${r}`)}return n}},803:e=>{e.exports="#version 300 es\r\nprecision highp float;\r\nprecision highp usampler2D;\r\n\r\nuniform float u_bluramount;\r\nuniform sampler2D u_texture;\r\nuniform usampler2D u_summedtexture;\r\n\r\nout vec4 outColor;\r\n\r\nvec4 getSummedArea(const in ivec2 minCoord, const in ivec2 maxCoord) {\r\n    return vec4(texelFetch(u_summedtexture, maxCoord, 0) - \r\n        texelFetch(u_summedtexture, ivec2(minCoord.x, maxCoord.y), 0) + \r\n        texelFetch(u_summedtexture, minCoord, 0) -\r\n        texelFetch(u_summedtexture, ivec2(maxCoord.x, minCoord.y), 0));\r\n}\r\n\r\nvec4 getPixel(const in ivec2 pos) {\r\n    return texelFetch(u_texture, pos, 0) * 255.0;\r\n}\r\n\r\n//results in up to 24 texture lookups based on complexity of range, whatever size the image is\r\nvec4 averageSummed(const in vec2 minCoord, const in vec2 maxCoord) {\r\n    ivec2 startCell = ivec2(floor(minCoord));\r\n    ivec2 endCell = ivec2(floor(maxCoord));\r\n\r\n    //range contained in one pixel\r\n    if (startCell == endCell) {\r\n        return texelFetch(u_texture, ivec2(startCell), 0);\r\n    }\r\n    \r\n    vec2 size = maxCoord - minCoord;\r\n    float pixelArea = size.x * size.y;\r\n    float colourNormaliser = 1.0 / pixelArea;\r\n    \r\n    ivec2 innerCell = ivec2(ceil(minCoord));\r\n    ivec2 innerCell2 = ivec2(floor(maxCoord));\r\n\r\n    vec2 minDiff = vec2(innerCell) - minCoord;\r\n    vec2 maxDiff = maxCoord - vec2(innerCell2);\r\n\r\n    vec4 colour = vec4(0.0);\r\n\r\n    //TODO: optimise by removing branches\r\n    \r\n    //single horizontal strip\r\n    if (startCell.x == endCell.x) {\r\n        if (minDiff.y > 0.0) {\r\n            colour += getPixel(startCell) * size.x * minDiff.y;\r\n        }\r\n\r\n        if (maxDiff.y > 0.0) {\r\n            colour += getPixel(endCell) * size.x * maxDiff.y;\r\n        }\r\n\r\n        colour += getSummedArea(ivec2(startCell.x, innerCell.y)-1, ivec2(startCell.x, innerCell2.y-1)) * size.x;\r\n        return floor(colour * colourNormaliser);\r\n    }\r\n    \r\n    //single vertical strip\r\n    if (startCell.y == endCell.y) {\r\n        if (minDiff.x > 0.0) {\r\n            colour += getPixel(startCell) * size.y * minDiff.x;\r\n        }\r\n\r\n        if (maxDiff.x > 0.0) {\r\n            colour += getPixel(endCell) * size.y * maxDiff.x;\r\n        }\r\n\r\n        colour += getSummedArea(ivec2(innerCell.x, startCell.y)-1, ivec2(innerCell2.x-1, startCell.y)) * size.y;\r\n        return floor(colour * colourNormaliser);\r\n    }\r\n\r\n    //corner cells\r\n    if (minDiff.y > 0.0) {\r\n        if (minDiff.x > 0.0) {\r\n            colour += getPixel(startCell) * minDiff.x * minDiff.y;\r\n        }\r\n\r\n        if (maxDiff.x > 0.0) {\r\n            colour += getPixel(ivec2(endCell.x, startCell.y)) * maxDiff.x * minDiff.y;\r\n        }\r\n    }\r\n\r\n    if (maxDiff.y > 0.0) {\r\n        if (minDiff.x > 0.0) {\r\n            colour += getPixel(ivec2(startCell.x, endCell.y)) * minDiff.x * maxDiff.y;\r\n        }\r\n\r\n        if (maxDiff.x > 0.0) {\r\n            colour += getPixel(endCell) * maxDiff.x * maxDiff.y;\r\n        }\r\n    }\r\n\r\n    //fractional strips\r\n    if (minDiff.y > 0.0) {\r\n        colour += getSummedArea(ivec2(innerCell.x, startCell.y)-1, ivec2(innerCell2.x-1, startCell.y)) * minDiff.y;\r\n    }\r\n\r\n    if (minDiff.x > 0.0) {\r\n        colour += getSummedArea(ivec2(startCell.x, innerCell.y)-1, ivec2(startCell.x, innerCell2.y-1)) * minDiff.x;\r\n    }\r\n\r\n    if (maxDiff.y > 0.0) {\r\n        colour += getSummedArea(ivec2(innerCell.x, endCell.y)-1, ivec2(innerCell2.x-1, endCell.y)) * maxDiff.y;\r\n    }\r\n\r\n    if (maxDiff.x > 0.0) {\r\n        colour += getSummedArea(ivec2(endCell.x, innerCell.y)-1, ivec2(endCell.x, innerCell2.y-1)) * maxDiff.x;\r\n    }\r\n\r\n    //inner parts\r\n    colour += getSummedArea(ivec2(innerCell)-1, ivec2(innerCell2)-1);\r\n    \r\n    //now we have an accumulative pixel value that covers the whole area so just average it\r\n    return floor(colour * colourNormaliser);\r\n}\r\n\r\nvoid main() {\r\n    ivec2 fragCoord = ivec2(gl_FragCoord.xy);\r\n    vec2 tex_size = vec2(textureSize(u_summedtexture, 0));\r\n\r\n    vec2 minCoord = clamp(vec2(fragCoord) - u_bluramount, vec2(0.0), tex_size);\r\n    vec2 maxCoord = clamp(vec2(fragCoord) + u_bluramount, vec2(0.0), tex_size);\r\n\r\n    vec4 pixelColour = averageSummed(minCoord, maxCoord);\r\n\r\n    /*\r\n    //simple test - show the original image pixel using the summed texture (requires 4 lookups - that is why we upload both to the gpu)\r\n    vec4 pixelColour = vec4(\r\n        texelFetch(u_summedtexture, fragCoord, 0) - \r\n        texelFetch(u_summedtexture, ivec2(fragCoord.x - 1, fragCoord.y), 0) + \r\n        texelFetch(u_summedtexture, fragCoord - 1, 0) -\r\n        texelFetch(u_summedtexture, ivec2(fragCoord.x, fragCoord.y - 1), 0)\r\n    );\r\n    */\r\n\r\n    outColor = pixelColour / 255.0;\r\n}\r\n"},467:e=>{e.exports="#version 300 es\r\nin vec2 a_position;\r\n\r\nvoid main() {\r\n    gl_Position = vec4(a_position, 0.0, 1.0);\r\n}\r\n"}},r={};!function t(n){var o=r[n];if(void 0!==o)return o.exports;var i=r[n]={exports:{}};return e[n].call(i.exports,i,i.exports,t),i.exports}(851)})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zYW1wbGluZy1jb3ZlcmFnZS8uL3NyYy9kZW1vcy9mYXN0Qmx1cldlYmdsLnRzIiwid2VicGFjazovL3NhbXBsaW5nLWNvdmVyYWdlLy4vc3JjL2RyYXcvY3JlYXRlUmVuZGVyZXIudHMiLCJ3ZWJwYWNrOi8vc2FtcGxpbmctY292ZXJhZ2UvLi9zcmMvZHJhdy9jcmVhdGVTdW1tZWRUZXh0dXJlV2ViZ2wudHMiLCJ3ZWJwYWNrOi8vc2FtcGxpbmctY292ZXJhZ2UvLi9zcmMvbWF0aHMvbWFrZUxvZ1NjYWxlLnRzIiwid2VicGFjazovL3NhbXBsaW5nLWNvdmVyYWdlLy4vc3JjL3V0aWxzL2FkZDRNdXRhdGUudHMiLCJ3ZWJwYWNrOi8vc2FtcGxpbmctY292ZXJhZ2UvLi9zcmMvdXRpbHMvZ2V0SW1hZ2VEYXRhLnRzIiwid2VicGFjazovL3NhbXBsaW5nLWNvdmVyYWdlLy4vc3JjL3V0aWxzL3N1YnRyYWN0NE11dGF0ZS50cyIsIndlYnBhY2s6Ly9zYW1wbGluZy1jb3ZlcmFnZS8uL3NyYy93ZWJnbC9jcmVhdGVQcm9ncmFtLnRzIiwid2VicGFjazovL3NhbXBsaW5nLWNvdmVyYWdlLy4vc3JjL3dlYmdsL2xvYWRTaGFkZXIudHMiLCJ3ZWJwYWNrOi8vc2FtcGxpbmctY292ZXJhZ2Uvd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vc2FtcGxpbmctY292ZXJhZ2Uvd2VicGFjay9zdGFydHVwIl0sIm5hbWVzIjpbIl9faW1wb3J0RGVmYXVsdCIsInRoaXMiLCJtb2QiLCJfX2VzTW9kdWxlIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJleHBvcnRzIiwidmFsdWUiLCJjcmVhdGVSZW5kZXJlcl8xIiwiY3JlYXRlU3VtbWVkVGV4dHVyZVdlYmdsXzEiLCJtYWtlTG9nU2NhbGVfMSIsImdldEltYWdlRGF0YV8xIiwibG9hZFNoYWRlcl8xIiwiY3JlYXRlUHJvZ3JhbV8xIiwiYmx1cl92ZXJ0XzEiLCJibHVyX2ZyYWdfMSIsImdhbWUiLCJkb2N1bWVudCIsImdldEVsZW1lbnRCeUlkIiwiaW1hZ2UiLCJhbW91bnRJbnB1dCIsImFtb3VudFZhbHVlSW5wdXQiLCJ0aW1ldGFrZW4iLCJnbCIsImdldENvbnRleHQiLCJFcnJvciIsImJsdXJVbmlmb3JtTG9jYXRpb24iLCJibHVyQW1vdW50Iiwic3RhcnQiLCJibHVyTG9nU2NhbGUiLCJtYWtlTG9nU2NhbGUiLCJjbGVhckNvbG9yIiwidmVydFNoYWRlciIsImxvYWRTaGFkZXIiLCJkZWZhdWx0IiwiVkVSVEVYX1NIQURFUiIsImZyYWdTaGFkZXIiLCJGUkFHTUVOVF9TSEFERVIiLCJwcm9ncmFtIiwiY3JlYXRlUHJvZ3JhbSIsInNjcmVlblRyaWFuZ2xlIiwiY3JlYXRlVmVydGV4QXJyYXkiLCJiaW5kVmVydGV4QXJyYXkiLCJwb3NpdGlvbkJ1ZmZlciIsImNyZWF0ZUJ1ZmZlciIsImJpbmRCdWZmZXIiLCJBUlJBWV9CVUZGRVIiLCJidWZmZXJEYXRhIiwiRmxvYXQzMkFycmF5IiwiU1RBVElDX0RSQVciLCJ0ZXh0dXJlIiwiY3JlYXRlVGV4dHVyZSIsImJpbmRUZXh0dXJlIiwiVEVYVFVSRV8yRCIsInBpeGVsU3RvcmVpIiwiVU5QQUNLX0ZMSVBfWV9XRUJHTCIsInRleEltYWdlMkQiLCJSR0JBIiwiVU5TSUdORURfQllURSIsImdlbmVyYXRlTWlwbWFwIiwid2lkdGgiLCJoZWlnaHQiLCJzdW1tZWRJbWFnZSIsImNyZWF0ZVN1bW1lZFRleHR1cmVXZWJnbCIsImdldEltYWdlRGF0YSIsInN1bW1lZFRleHR1cmUiLCJSR0JBMzJVSSIsIlJHQkFfSU5URUdFUiIsIlVOU0lHTkVEX0lOVCIsInRleFBhcmFtZXRlcmkiLCJURVhUVVJFX01BR19GSUxURVIiLCJORUFSRVNUIiwiVEVYVFVSRV9NSU5fRklMVEVSIiwiVEVYVFVSRV9XUkFQX1MiLCJDTEFNUF9UT19FREdFIiwiVEVYVFVSRV9XUkFQX1QiLCJ1c2VQcm9ncmFtIiwicG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiIsImdldEF0dHJpYkxvY2F0aW9uIiwiZW5hYmxlVmVydGV4QXR0cmliQXJyYXkiLCJ2ZXJ0ZXhBdHRyaWJQb2ludGVyIiwiRkxPQVQiLCJ0ZXh0dXJlVW5pZm9ybUxvY2F0aW9uIiwiZ2V0VW5pZm9ybUxvY2F0aW9uIiwidW5pZm9ybTFpIiwiYWN0aXZlVGV4dHVyZSIsIlRFWFRVUkUwIiwic3VtbWVkVGV4dHVyZVVuaWZvcm1Mb2NhdGlvbiIsIlRFWFRVUkUxIiwiZHJhdyIsImNyZWF0ZVJlbmRlcmVyIiwidG9TdHJpbmciLCJ0b0xpbmVhciIsInN0YXJ0VGltZSIsIkRhdGUiLCJub3ciLCJ2aWV3cG9ydCIsImNhbnZhcyIsImNsZWFyIiwiQ09MT1JfQlVGRkVSX0JJVCIsIkRFUFRIX0JVRkZFUl9CSVQiLCJ1bmlmb3JtMWYiLCJkcmF3QXJyYXlzIiwiVFJJQU5HTEVTIiwiaW5uZXJUZXh0IiwicmVuZGVyIiwib25pbnB1dCIsInBhcnNlRmxvYXQiLCJmcm9tTGluZWFyIiwidG9GaXhlZCIsIm9uY2hhbmdlIiwiY29tcGxldGUiLCJvbmxvYWQiLCJyZW5kZXJGdW5jIiwiYWZ0ZXJSZW5kZXJGdW5jIiwiZHJhd2luZyIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsImFkZDRNdXRhdGVfMSIsInN1YnRyYWN0NE11dGF0ZV8xIiwiaW1hZ2VEYXRhIiwiQXJyYXkiLCJ5IiwieCIsImkiLCJwaXgiLCJVaW50MzJBcnJheSIsImRhdGEiLCJzbGljZSIsImFkZDRNdXRhdGUiLCJzdWJ0cmFjdDRNdXRhdGUiLCJzdW1tZWRJbWFnZVJhdyIsInJvdyIsImZyb20iLCJ0byIsIm1pbiIsIk1hdGgiLCJsb2ciLCJzY2FsZSIsImV4cCIsImxvZ1ZhbHVlIiwiYSIsImIiLCJpbWFnZUNhbnZhcyIsImNyZWF0ZUVsZW1lbnQiLCJpbWFnZUdyYXBoaWNzIiwiY2xlYXJSZWN0IiwiZHJhd0ltYWdlIiwiYXR0YWNoU2hhZGVyIiwibGlua1Byb2dyYW0iLCJnZXRQcm9ncmFtUGFyYW1ldGVyIiwiTElOS19TVEFUVVMiLCJlcnJvck1lc3NhZ2UiLCJnZXRQcm9ncmFtSW5mb0xvZyIsImRlbGV0ZVByb2dyYW0iLCJzb3VyY2UiLCJ0eXBlIiwic2hhZGVyIiwiY3JlYXRlU2hhZGVyIiwic2hhZGVyU291cmNlIiwiY29tcGlsZVNoYWRlciIsImdldFNoYWRlclBhcmFtZXRlciIsIkNPTVBJTEVfU1RBVFVTIiwiZ2V0U2hhZGVySW5mb0xvZyIsImRlbGV0ZVNoYWRlciIsIl9fd2VicGFja19tb2R1bGVfY2FjaGVfXyIsIl9fd2VicGFja19yZXF1aXJlX18iLCJtb2R1bGVJZCIsImNhY2hlZE1vZHVsZSIsInVuZGVmaW5lZCIsIm1vZHVsZSIsIl9fd2VicGFja19tb2R1bGVzX18iLCJjYWxsIl0sIm1hcHBpbmdzIjoiOENBQ0EsSUFBSUEsRUFBbUJDLE1BQVFBLEtBQUtELGlCQUFvQixTQUFVRSxHQUM5RCxPQUFRQSxHQUFPQSxFQUFJQyxXQUFjRCxFQUFNLENBQUUsUUFBV0EsSUFFeERFLE9BQU9DLGVBQWVDLEVBQVMsYUFBYyxDQUFFQyxPQUFPLElBQ3RELE1BQU1DLEVBQW1CLEVBQVEsS0FDM0JDLEVBQTZCLEVBQVEsS0FDckNDLEVBQWlCLEVBQVEsS0FDekJDLEVBQWlCLEVBQVEsS0FDekJDLEVBQWUsRUFBUSxLQUN2QkMsRUFBa0IsRUFBUSxLQUMxQkMsRUFBY2QsRUFBZ0IsRUFBUSxNQUN0Q2UsRUFBY2YsRUFBZ0IsRUFBUSxNQUN0Q2dCLEVBQU9DLFNBQVNDLGVBQWUsUUFDL0JDLEVBQVFGLFNBQVNDLGVBQWUsU0FDaENFLEVBQWNILFNBQVNDLGVBQWUsVUFDdENHLEVBQW1CSixTQUFTQyxlQUFlLGVBQzNDSSxFQUFZTCxTQUFTQyxlQUFlLGFBRXBDSyxFQUFLUCxFQUFLUSxXQUFXLFVBQzNCLElBQUtELEVBQ0QsTUFBTSxJQUFJRSxNQUFNLHdCQUVwQixJQUNJQyxFQURBQyxFQUFhLEVBRWpCLE1BV01DLEVBQVEsS0FDVixNQUFNQyxFQUFlbkIsRUFBZW9CLGFBQWEsRUFBRyxLQUNwRFAsRUFBR1EsV0FBVyxFQUFHLEVBQUcsRUFBRyxHQUN2QixNQUFNQyxFQUFhcEIsRUFBYXFCLFdBQVdWLEVBQUlULEVBQVlvQixRQUFTWCxFQUFHWSxlQUNqRUMsRUFBYXhCLEVBQWFxQixXQUFXVixFQUFJUixFQUFZbUIsUUFBU1gsRUFBR2MsaUJBQ2pFQyxFQUFVekIsRUFBZ0IwQixjQUFjaEIsRUFBSVMsRUFBWUksR0FFeERJLEVBQWlCakIsRUFBR2tCLG9CQUMxQixHQUF1QixPQUFuQkQsRUFDQSxNQUFNLElBQUlmLE1BQU0sb0NBRXBCRixFQUFHbUIsZ0JBQWdCRixHQUNuQixNQUFNRyxFQUFpQnBCLEVBQUdxQixlQUMxQnJCLEVBQUdzQixXQUFXdEIsRUFBR3VCLGFBQWNILEdBQy9CcEIsRUFBR3dCLFdBQVd4QixFQUFHdUIsYUFBYyxJQUFJRSxhQUFhLEVBQUUsR0FBSSxFQUFHLEdBQUksR0FBSSxFQUFHLElBQUt6QixFQUFHMEIsYUFFNUUsTUFBTUMsRUFBVTNCLEVBQUc0QixnQkFVbkIsR0FUQTVCLEVBQUc2QixZQUFZN0IsRUFBRzhCLFdBQVlILEdBQzlCM0IsRUFBRytCLFlBQVkvQixFQUFHZ0MscUJBQXFCLEdBQ3ZDaEMsRUFBR2lDLFdBQVdqQyxFQUFHOEIsV0FBWSxFQUFHOUIsRUFBR2tDLEtBQU1sQyxFQUFHa0MsS0FBTWxDLEVBQUdtQyxjQUFldkMsR0FDcEVJLEVBQUdvQyxlQUFlcEMsRUFBRzhCLFlBTWpCbEMsRUFBTXlDLE1BQVF6QyxFQUFNMEMsT0FETixTQUVkLE1BQU0sSUFBSXBDLE1BQU0sOENBRXBCLE1BQU1xQyxFQUFjckQsRUFBMkJzRCx5QkFBeUJwRCxFQUFlcUQsYUFBYTdDLElBQzlGOEMsRUFBZ0IxQyxFQUFHNEIsZ0JBQ3pCNUIsRUFBRzZCLFlBQVk3QixFQUFHOEIsV0FBWVksR0FDOUIxQyxFQUFHaUMsV0FBV2pDLEVBQUc4QixXQUFZLEVBQUc5QixFQUFHMkMsU0FBVS9DLEVBQU15QyxNQUFPekMsRUFBTTBDLE9BQVEsRUFBR3RDLEVBQUc0QyxhQUFjNUMsRUFBRzZDLGFBQWNOLEdBQzdHdkMsRUFBRzhDLGNBQWM5QyxFQUFHOEIsV0FBWTlCLEVBQUcrQyxtQkFBb0IvQyxFQUFHZ0QsU0FDMURoRCxFQUFHOEMsY0FBYzlDLEVBQUc4QixXQUFZOUIsRUFBR2lELG1CQUFvQmpELEVBQUdnRCxTQUMxRGhELEVBQUc4QyxjQUFjOUMsRUFBRzhCLFdBQVk5QixFQUFHa0QsZUFBZ0JsRCxFQUFHbUQsZUFDdERuRCxFQUFHOEMsY0FBYzlDLEVBQUc4QixXQUFZOUIsRUFBR29ELGVBQWdCcEQsRUFBR21ELGVBRXREbkQsRUFBR3FELFdBQVd0QyxHQUNkLE1BQU11QyxFQUE0QnRELEVBQUd1RCxrQkFBa0J4QyxFQUFTLGNBQ2hFZixFQUFHc0IsV0FBV3RCLEVBQUd1QixhQUFjSCxHQUMvQnBCLEVBQUd3RCx3QkFBd0JGLEdBQzNCdEQsRUFBR3lELG9CQUFvQkgsRUFBMkIsRUFBR3RELEVBQUcwRCxPQUFPLEVBQU8sRUFBRyxHQUN6RSxNQUFNQyxFQUF5QjNELEVBQUc0RCxtQkFBbUI3QyxFQUFTLGFBQzlEZixFQUFHNkQsVUFBVUYsRUFBd0IsR0FDckMzRCxFQUFHOEQsY0FBYzlELEVBQUcrRCxVQUNwQi9ELEVBQUc2QixZQUFZN0IsRUFBRzhCLFdBQVlILEdBQzlCeEIsRUFBc0JILEVBQUc0RCxtQkFBbUI3QyxFQUFTLGdCQUNyRCxNQUFNaUQsRUFBK0JoRSxFQUFHNEQsbUJBQW1CN0MsRUFBUyxtQkFDcEVmLEVBQUc2RCxVQUFVRyxFQUE4QixHQUMzQ2hFLEVBQUc4RCxjQUFjOUQsRUFBR2lFLFVBQ3BCakUsRUFBRzZCLFlBQVk3QixFQUFHOEIsV0FBWVksR0FFOUIsTUFBTXdCLEVBQU9qRixFQUFpQmtGLGdCQUFlLEtBQ3pDckUsRUFBaUJkLE1BQVFvQixFQUFXZ0UsV0FDcEN2RSxFQUFZYixNQUFRc0IsRUFBYStELFNBQVNqRSxHQUFZZ0UsV0FsRS9DLEVBQUNyRCxFQUFTRSxLQUNyQixNQUFNcUQsRUFBWUMsS0FBS0MsTUFDdkJ4RSxFQUFHeUUsU0FBUyxFQUFHLEVBQUd6RSxFQUFHMEUsT0FBT3JDLE1BQU9yQyxFQUFHMEUsT0FBT3BDLFFBQzdDdEMsRUFBRzJFLE1BQU0zRSxFQUFHNEUsaUJBQW1CNUUsRUFBRzZFLGtCQUVsQzdFLEVBQUdxRCxXQUFXdEMsR0FDZGYsRUFBRzhFLFVBQVUzRSxFQUFxQkMsR0FDbENKLEVBQUdtQixnQkFBZ0JGLEdBQ25CakIsRUFBRytFLFdBQVcvRSxFQUFHZ0YsVUFBVyxFQUFHLEdBQy9CakYsRUFBVWtGLFVBQWdCVixLQUFLQyxNQUFRRixFQUFqQixPQTBEbEJZLENBQU9uRSxFQUFTRSxNQUVwQnBCLEVBQVlzRixRQUFVLEtBRWxCL0UsRUFBYWdGLFdBQVc5RSxFQUFhK0UsV0FBV0QsV0FBV3ZGLEVBQVliLFFBQVFzRyxRQUFRLElBQ3ZGcEIsS0FFSnBFLEVBQWlCeUYsU0FBVyxLQUN4Qm5GLEVBQWFnRixXQUFXdEYsRUFBaUJkLE9BQ3pDa0YsS0FFSkEsS0FFQXRFLEVBQU00RixTQUNObkYsSUFHQVQsRUFBTTZGLE9BQVNwRixHLFlDNUduQnhCLE9BQU9DLGVBQWVDLEVBQVMsYUFBYyxDQUFFQyxPQUFPLElBQ3RERCxFQUFRb0Ysb0JBQWlCLEVBY3pCcEYsRUFBUW9GLGVBYmUsQ0FBQ3VCLEVBQVlDLEtBQ2hDLElBQUlDLEdBQVUsRUFDZCxNQUFPLEtBQ0VBLElBQ0RBLEdBQVUsRUFDVkMsdUJBQXNCLEtBQ2xCSCxJQUNBRSxHQUFVLEVBQ1ZELFNBQWtFQSxXLGNDVmxGOUcsT0FBT0MsZUFBZUMsRUFBUyxhQUFjLENBQUVDLE9BQU8sSUFDdERELEVBQVF5RCw4QkFBMkIsRUFDbkMsTUFBTXNELEVBQWUsRUFBUSxJQUN2QkMsRUFBb0IsRUFBUSxLQWtDbENoSCxFQUFReUQseUJBaEMwQndELElBQzlCLE1BQU10RCxFQUFnQixJQUFJdUQsTUFBTUQsRUFBVTFELFFBQzFDLElBQUssSUFBSTRELEVBQUksRUFBR0EsRUFBSUYsRUFBVTFELE9BQVE0RCxJQUFLLENBQ3ZDeEQsRUFBY3dELEdBQUssSUFBSUQsTUFBTUQsRUFBVTNELE9BQ3ZDLElBQUssSUFBSThELEVBQUksRUFBR0EsRUFBSUgsRUFBVTNELE1BQU84RCxJQUFLLENBQ3RDLE1BQU1DLEVBQXlELElBQW5ESixFQUFVMUQsT0FBUyxFQUFJNEQsR0FBS0YsRUFBVTNELE1BQVE4RCxHQUNwREUsRUFBTSxJQUFJQyxZQUFZTixFQUFVTyxLQUFLQyxNQUFNSixFQUFHQSxFQUFJLElBQ3BERCxFQUFJLEdBQ0pMLEVBQWFXLFdBQVdKLEVBQUszRCxFQUFjd0QsR0FBR0MsRUFBSSxJQUVsREQsRUFBSSxHQUNKSixFQUFhVyxXQUFXSixFQUFLM0QsRUFBY3dELEVBQUksR0FBR0MsSUFFbERBLEVBQUksR0FBS0QsRUFBSSxHQUNiSCxFQUFrQlcsZ0JBQWdCTCxFQUFLM0QsRUFBY3dELEVBQUksR0FBR0MsRUFBSSxJQUVwRXpELEVBQWN3RCxHQUFHQyxHQUFLRSxHQUc5QixNQUFNTSxFQUFpQixJQUFJTCxZQUFZTixFQUFVM0QsTUFBUTJELEVBQVUxRCxPQUFTLEdBQzVFLElBQUssSUFBSThELEVBQUksRUFBR0YsRUFBSUYsRUFBVTFELE9BQVMsRUFBRzRELEdBQUssRUFBR0EsSUFBSyxDQUNuRCxNQUFNVSxFQUFNbEUsRUFBY3dELEdBQzFCLElBQUssSUFBSUMsRUFBSSxFQUFHQSxFQUFJSCxFQUFVM0QsTUFBTzhELElBQUtDLEdBQUssRUFBRyxDQUM5QyxNQUFNQyxFQUFNTyxFQUFJVCxHQUNoQlEsRUFBZVAsR0FBS0MsRUFBSSxHQUN4Qk0sRUFBZVAsRUFBSSxHQUFLQyxFQUFJLEdBQzVCTSxFQUFlUCxFQUFJLEdBQUtDLEVBQUksR0FDNUJNLEVBQWVQLEVBQUksR0FBS0MsRUFBSSxJQUdwQyxPQUFPTSxJLFlDbkNYOUgsT0FBT0MsZUFBZUMsRUFBUyxhQUFjLENBQUVDLE9BQU8sSUFDdERELEVBQVF3QixrQkFBZSxFQVV2QnhCLEVBQVF3QixhQVRhLENBQUNzRyxFQUFNQyxLQUN4QixNQUFNQyxFQUFNRixFQUFPRyxLQUFLQyxJQUFJSixHQUFRLEVBRTlCSyxFQURNRixLQUFLQyxJQUFJSCxHQUNEQyxFQUNwQixNQUFPLENBQ0gxQixXQUFhckcsR0FBVWdJLEtBQUtHLElBQUlKLEVBQU1HLEVBQVFsSSxHQUM5Q3FGLFNBQVcrQyxJQUFjSixLQUFLQyxJQUFJRyxHQUFZTCxHQUFPRyxLLFdDUjdEckksT0FBT0MsZUFBZUMsRUFBUyxhQUFjLENBQUVDLE9BQU8sSUFDdERELEVBQVEwSCxnQkFBYSxFQVFyQjFILEVBQVEwSCxXQVBXLENBQUNZLEVBQUdDLEtBQ25CRCxFQUFFLElBQU1DLEVBQUUsR0FDVkQsRUFBRSxJQUFNQyxFQUFFLEdBQ1ZELEVBQUUsSUFBTUMsRUFBRSxHQUNWRCxFQUFFLElBQU1DLEVBQUUsR0FDSEQsSSxZQ1BYeEksT0FBT0MsZUFBZUMsRUFBUyxhQUFjLENBQUVDLE9BQU8sSUFDdERELEVBQVEwRCxrQkFBZSxFQWF2QjFELEVBQVEwRCxhQVpjN0MsSUFDbEIsTUFBTTJILEVBQWM3SCxTQUFTOEgsY0FBYyxVQUMzQ0QsRUFBWWxGLE1BQVF6QyxFQUFNeUMsTUFDMUJrRixFQUFZakYsT0FBUzFDLEVBQU0wQyxPQUMzQixNQUFNbUYsRUFBZ0JGLEVBQVl0SCxXQUFXLE1BQzdDLElBQUt3SCxFQUNELE1BQU0sSUFBSXZILE1BQU0saURBSXBCLE9BRkF1SCxFQUFjQyxVQUFVLEVBQUcsRUFBR0gsRUFBWWxGLE1BQU9rRixFQUFZakYsUUFDN0RtRixFQUFjRSxVQUFVL0gsRUFBTyxFQUFHLEdBQzNCNkgsRUFBY2hGLGFBQWEsRUFBRyxFQUFHOEUsRUFBWWxGLE1BQU9rRixFQUFZakYsVSxZQ1ozRXpELE9BQU9DLGVBQWVDLEVBQVMsYUFBYyxDQUFFQyxPQUFPLElBQ3RERCxFQUFRMkgscUJBQWtCLEVBUTFCM0gsRUFBUTJILGdCQVBnQixDQUFDVyxFQUFHQyxLQUN4QkQsRUFBRSxJQUFNQyxFQUFFLEdBQ1ZELEVBQUUsSUFBTUMsRUFBRSxHQUNWRCxFQUFFLElBQU1DLEVBQUUsR0FDVkQsRUFBRSxJQUFNQyxFQUFFLEdBQ0hELEksWUNQWHhJLE9BQU9DLGVBQWVDLEVBQVMsYUFBYyxDQUFFQyxPQUFPLElBQ3RERCxFQUFRaUMsbUJBQWdCLEVBaUJ4QmpDLEVBQVFpQyxjQWhCYyxDQUFDaEIsRUFBSVMsRUFBWUksS0FDbkMsTUFBTUUsRUFBVWYsRUFBR2dCLGdCQUNuQixHQUFnQixPQUFaRCxFQUNBLE1BQU0sSUFBSWIsTUFBTSw0QkFNcEIsR0FKQUYsRUFBRzRILGFBQWE3RyxFQUFTTixHQUN6QlQsRUFBRzRILGFBQWE3RyxFQUFTRixHQUN6QmIsRUFBRzZILFlBQVk5RyxJQUNBZixFQUFHOEgsb0JBQW9CL0csRUFBU2YsRUFBRytILGFBQ3JDLENBQ1QsTUFBTUMsRUFBZWhJLEVBQUdpSSxrQkFBa0JsSCxHQUUxQyxNQURBZixFQUFHa0ksY0FBY25ILEdBQ1gsSUFBSWIsTUFBTSwyQkFBMkI4SCxLQUUvQyxPQUFPakgsSSxZQ2hCWGxDLE9BQU9DLGVBQWVDLEVBQVMsYUFBYyxDQUFFQyxPQUFPLElBQ3RERCxFQUFRMkIsZ0JBQWEsRUFnQnJCM0IsRUFBUTJCLFdBZlcsQ0FBQ1YsRUFBSW1JLEVBQVFDLEtBQzVCLE1BQU1DLEVBQVNySSxFQUFHc0ksYUFBYUYsR0FDL0IsR0FBZSxPQUFYQyxFQUNBLE1BQU0sSUFBSW5JLE1BQU0sMkJBS3BCLEdBSEFGLEVBQUd1SSxhQUFhRixFQUFRRixHQUN4Qm5JLEVBQUd3SSxjQUFjSCxJQUNBckksRUFBR3lJLG1CQUFtQkosRUFBUXJJLEVBQUcwSSxnQkFDbkMsQ0FDWCxNQUFNVixFQUFlaEksRUFBRzJJLGlCQUFpQk4sR0FFekMsTUFEQXJJLEVBQUc0SSxhQUFhUCxHQUNWLElBQUluSSxNQUFNLDJCQUEyQjhILEtBRS9DLE9BQU9LLEkscytKQ2ZQUSxFQUEyQixJQUcvQixTQUFTQyxFQUFvQkMsR0FFNUIsSUFBSUMsRUFBZUgsRUFBeUJFLEdBQzVDLFFBQXFCRSxJQUFqQkQsRUFDSCxPQUFPQSxFQUFhakssUUFHckIsSUFBSW1LLEVBQVNMLEVBQXlCRSxHQUFZLENBR2pEaEssUUFBUyxJQU9WLE9BSEFvSyxFQUFvQkosR0FBVUssS0FBS0YsRUFBT25LLFFBQVNtSyxFQUFRQSxFQUFPbkssUUFBUytKLEdBR3BFSSxFQUFPbkssUUNsQlcrSixDQUFvQixNIiwiZmlsZSI6ImZhc3RfYmx1cl93ZWJnbC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xyXG52YXIgX19pbXBvcnREZWZhdWx0ID0gKHRoaXMgJiYgdGhpcy5fX2ltcG9ydERlZmF1bHQpIHx8IGZ1bmN0aW9uIChtb2QpIHtcclxuICAgIHJldHVybiAobW9kICYmIG1vZC5fX2VzTW9kdWxlKSA/IG1vZCA6IHsgXCJkZWZhdWx0XCI6IG1vZCB9O1xyXG59O1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmNvbnN0IGNyZWF0ZVJlbmRlcmVyXzEgPSByZXF1aXJlKFwiLi4vZHJhdy9jcmVhdGVSZW5kZXJlclwiKTtcclxuY29uc3QgY3JlYXRlU3VtbWVkVGV4dHVyZVdlYmdsXzEgPSByZXF1aXJlKFwiLi4vZHJhdy9jcmVhdGVTdW1tZWRUZXh0dXJlV2ViZ2xcIik7XHJcbmNvbnN0IG1ha2VMb2dTY2FsZV8xID0gcmVxdWlyZShcIi4uL21hdGhzL21ha2VMb2dTY2FsZVwiKTtcclxuY29uc3QgZ2V0SW1hZ2VEYXRhXzEgPSByZXF1aXJlKFwiLi4vdXRpbHMvZ2V0SW1hZ2VEYXRhXCIpO1xyXG5jb25zdCBsb2FkU2hhZGVyXzEgPSByZXF1aXJlKFwiLi4vd2ViZ2wvbG9hZFNoYWRlclwiKTtcclxuY29uc3QgY3JlYXRlUHJvZ3JhbV8xID0gcmVxdWlyZShcIi4uL3dlYmdsL2NyZWF0ZVByb2dyYW1cIik7XHJcbmNvbnN0IGJsdXJfdmVydF8xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9zaGFkZXJzL2JsdXIudmVydFwiKSk7XHJcbmNvbnN0IGJsdXJfZnJhZ18xID0gX19pbXBvcnREZWZhdWx0KHJlcXVpcmUoXCIuLi9zaGFkZXJzL2JsdXIuZnJhZ1wiKSk7XHJcbmNvbnN0IGdhbWUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImdhbWVcIik7XHJcbmNvbnN0IGltYWdlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoXCJpbWFnZVwiKTtcclxuY29uc3QgYW1vdW50SW5wdXQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChcImFtb3VudFwiKTtcclxuY29uc3QgYW1vdW50VmFsdWVJbnB1dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwiYW1vdW50dmFsdWVcIik7XHJcbmNvbnN0IHRpbWV0YWtlbiA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKFwidGltZXRha2VuXCIpO1xyXG4vL25lZWQgdG8gdXNlIHdlYmdsIDIgdG8gYmUgYWJsZSB0byBjcmVhdGUgYSBzdWl0YWJsZSBzdW1tZWQgdGV4dHVyZSB3aXRob3V0IGNvbXByZXNzaW9uXHJcbmNvbnN0IGdsID0gZ2FtZS5nZXRDb250ZXh0KFwid2ViZ2wyXCIpO1xyXG5pZiAoIWdsKSB7XHJcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJObyBXZWJHTDIgU3VwcG9ydCA6KFwiKTtcclxufVxyXG5sZXQgYmx1ckFtb3VudCA9IDg7XHJcbmxldCBibHVyVW5pZm9ybUxvY2F0aW9uO1xyXG5jb25zdCByZW5kZXIgPSAocHJvZ3JhbSwgc2NyZWVuVHJpYW5nbGUpID0+IHtcclxuICAgIGNvbnN0IHN0YXJ0VGltZSA9IERhdGUubm93KCk7XHJcbiAgICBnbC52aWV3cG9ydCgwLCAwLCBnbC5jYW52YXMud2lkdGgsIGdsLmNhbnZhcy5oZWlnaHQpO1xyXG4gICAgZ2wuY2xlYXIoZ2wuQ09MT1JfQlVGRkVSX0JJVCB8IGdsLkRFUFRIX0JVRkZFUl9CSVQpO1xyXG4gICAgLy9kcmF3IG91ciBzaW5nbGUgdHJpYW5nbGVcclxuICAgIGdsLnVzZVByb2dyYW0ocHJvZ3JhbSk7XHJcbiAgICBnbC51bmlmb3JtMWYoYmx1clVuaWZvcm1Mb2NhdGlvbiwgYmx1ckFtb3VudCk7XHJcbiAgICBnbC5iaW5kVmVydGV4QXJyYXkoc2NyZWVuVHJpYW5nbGUpO1xyXG4gICAgZ2wuZHJhd0FycmF5cyhnbC5UUklBTkdMRVMsIDAsIDMpO1xyXG4gICAgdGltZXRha2VuLmlubmVyVGV4dCA9IGAkeyhEYXRlLm5vdygpIC0gc3RhcnRUaW1lKX0gbXNgO1xyXG59O1xyXG5jb25zdCBzdGFydCA9ICgpID0+IHtcclxuICAgIGNvbnN0IGJsdXJMb2dTY2FsZSA9IG1ha2VMb2dTY2FsZV8xLm1ha2VMb2dTY2FsZSgwLCA1MTIpO1xyXG4gICAgZ2wuY2xlYXJDb2xvcigwLCAwLCAwLCAwKTtcclxuICAgIGNvbnN0IHZlcnRTaGFkZXIgPSBsb2FkU2hhZGVyXzEubG9hZFNoYWRlcihnbCwgYmx1cl92ZXJ0XzEuZGVmYXVsdCwgZ2wuVkVSVEVYX1NIQURFUik7XHJcbiAgICBjb25zdCBmcmFnU2hhZGVyID0gbG9hZFNoYWRlcl8xLmxvYWRTaGFkZXIoZ2wsIGJsdXJfZnJhZ18xLmRlZmF1bHQsIGdsLkZSQUdNRU5UX1NIQURFUik7XHJcbiAgICBjb25zdCBwcm9ncmFtID0gY3JlYXRlUHJvZ3JhbV8xLmNyZWF0ZVByb2dyYW0oZ2wsIHZlcnRTaGFkZXIsIGZyYWdTaGFkZXIpO1xyXG4gICAgLy9idWZmZXJzXHJcbiAgICBjb25zdCBzY3JlZW5UcmlhbmdsZSA9IGdsLmNyZWF0ZVZlcnRleEFycmF5KCk7XHJcbiAgICBpZiAoc2NyZWVuVHJpYW5nbGUgPT09IG51bGwpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBjcmVhdGUgc2NyZWVuIHRyaWFuZ2xlJyk7XHJcbiAgICB9XHJcbiAgICBnbC5iaW5kVmVydGV4QXJyYXkoc2NyZWVuVHJpYW5nbGUpO1xyXG4gICAgY29uc3QgcG9zaXRpb25CdWZmZXIgPSBnbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBwb3NpdGlvbkJ1ZmZlcik7XHJcbiAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgbmV3IEZsb2F0MzJBcnJheShbLTEsIC0xLCAzLCAtMSwgLTEsIDNdKSwgZ2wuU1RBVElDX0RSQVcpO1xyXG4gICAgLy8gLSBvcmlnaW5hbCB0ZXh0dXJlXHJcbiAgICBjb25zdCB0ZXh0dXJlID0gZ2wuY3JlYXRlVGV4dHVyZSgpO1xyXG4gICAgZ2wuYmluZFRleHR1cmUoZ2wuVEVYVFVSRV8yRCwgdGV4dHVyZSk7XHJcbiAgICBnbC5waXhlbFN0b3JlaShnbC5VTlBBQ0tfRkxJUF9ZX1dFQkdMLCB0cnVlKTtcclxuICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCQSwgZ2wuUkdCQSwgZ2wuVU5TSUdORURfQllURSwgaW1hZ2UpO1xyXG4gICAgZ2wuZ2VuZXJhdGVNaXBtYXAoZ2wuVEVYVFVSRV8yRCk7XHJcbiAgICAvLyAtIHN1bW1lZCB0ZXh0dXJlXHJcbiAgICAvLyBmbGF0dGVuIHRoZSBwcm9kdWNlZCBzdW1tZWQgaW1hZ2Ugc28gaXQgaXMgc3VpdGFibGUgZm9yIGNyZWF0aW5nIGEgdGV4dHVyZSBvdXQgb2YgaXRcclxuICAgIC8vIG9uY2Ugd2UgaGF2ZSBnZW5lcmF0ZWQgb3VyIHN1bW1tZWQgdGV4dHVyZSB3ZSBjYW4gcGFzcyBpdCB0byBvdXIgc2hhZGVycyB1c2luZyBSR0JBMzJVSSBmb3JtYXQgKDQgYnl0ZSB1bnNpZ25lZCBpbnQgcGVyIGNoYW5uZWwpXHJcbiAgICAvLyB0aGlzIG1lYW5zIHRoZSBzdW1tZWQgdGV4dHVyZSBjYW4gc3VwcG9ydCBzdW1taW5nIGZvciB0ZXh0dXJlcyBvZiB1cCB0byA0MDk2IHggNDA5NiAocGxlbnR5KVxyXG4gICAgY29uc3QgbWF4UGl4ZWxzID0gNDA5NiAqIDQwOTY7XHJcbiAgICBpZiAoaW1hZ2Uud2lkdGggKiBpbWFnZS5oZWlnaHQgPiBtYXhQaXhlbHMpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJJbWFnZSB0b28gYmlnLCB1cCB0byA0MDk2IHggNDA5NiBzdXBwb3J0ZWRcIik7XHJcbiAgICB9XHJcbiAgICBjb25zdCBzdW1tZWRJbWFnZSA9IGNyZWF0ZVN1bW1lZFRleHR1cmVXZWJnbF8xLmNyZWF0ZVN1bW1lZFRleHR1cmVXZWJnbChnZXRJbWFnZURhdGFfMS5nZXRJbWFnZURhdGEoaW1hZ2UpKTtcclxuICAgIGNvbnN0IHN1bW1lZFRleHR1cmUgPSBnbC5jcmVhdGVUZXh0dXJlKCk7XHJcbiAgICBnbC5iaW5kVGV4dHVyZShnbC5URVhUVVJFXzJELCBzdW1tZWRUZXh0dXJlKTtcclxuICAgIGdsLnRleEltYWdlMkQoZ2wuVEVYVFVSRV8yRCwgMCwgZ2wuUkdCQTMyVUksIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsIDAsIGdsLlJHQkFfSU5URUdFUiwgZ2wuVU5TSUdORURfSU5ULCBzdW1tZWRJbWFnZSk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUFHX0ZJTFRFUiwgZ2wuTkVBUkVTVCk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfTUlOX0ZJTFRFUiwgZ2wuTkVBUkVTVCk7XHJcbiAgICBnbC50ZXhQYXJhbWV0ZXJpKGdsLlRFWFRVUkVfMkQsIGdsLlRFWFRVUkVfV1JBUF9TLCBnbC5DTEFNUF9UT19FREdFKTtcclxuICAgIGdsLnRleFBhcmFtZXRlcmkoZ2wuVEVYVFVSRV8yRCwgZ2wuVEVYVFVSRV9XUkFQX1QsIGdsLkNMQU1QX1RPX0VER0UpO1xyXG4gICAgLy9iaW5kIGJ1ZmZlcnMgdG8gc2hhZGVyXHJcbiAgICBnbC51c2VQcm9ncmFtKHByb2dyYW0pO1xyXG4gICAgY29uc3QgcG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiA9IGdsLmdldEF0dHJpYkxvY2F0aW9uKHByb2dyYW0sIFwiYV9wb3NpdGlvblwiKTtcclxuICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCBwb3NpdGlvbkJ1ZmZlcik7XHJcbiAgICBnbC5lbmFibGVWZXJ0ZXhBdHRyaWJBcnJheShwb3NpdGlvbkF0dHJpYnV0ZUxvY2F0aW9uKTtcclxuICAgIGdsLnZlcnRleEF0dHJpYlBvaW50ZXIocG9zaXRpb25BdHRyaWJ1dGVMb2NhdGlvbiwgMiwgZ2wuRkxPQVQsIGZhbHNlLCAwLCAwKTtcclxuICAgIGNvbnN0IHRleHR1cmVVbmlmb3JtTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgXCJ1X3RleHR1cmVcIik7XHJcbiAgICBnbC51bmlmb3JtMWkodGV4dHVyZVVuaWZvcm1Mb2NhdGlvbiwgMCk7XHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUwKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHRleHR1cmUpO1xyXG4gICAgYmx1clVuaWZvcm1Mb2NhdGlvbiA9IGdsLmdldFVuaWZvcm1Mb2NhdGlvbihwcm9ncmFtLCBcInVfYmx1cmFtb3VudFwiKTtcclxuICAgIGNvbnN0IHN1bW1lZFRleHR1cmVVbmlmb3JtTG9jYXRpb24gPSBnbC5nZXRVbmlmb3JtTG9jYXRpb24ocHJvZ3JhbSwgXCJ1X3N1bW1lZHRleHR1cmVcIik7XHJcbiAgICBnbC51bmlmb3JtMWkoc3VtbWVkVGV4dHVyZVVuaWZvcm1Mb2NhdGlvbiwgMSk7XHJcbiAgICBnbC5hY3RpdmVUZXh0dXJlKGdsLlRFWFRVUkUxKTtcclxuICAgIGdsLmJpbmRUZXh0dXJlKGdsLlRFWFRVUkVfMkQsIHN1bW1lZFRleHR1cmUpO1xyXG4gICAgLy9pbnB1dHNcclxuICAgIGNvbnN0IGRyYXcgPSBjcmVhdGVSZW5kZXJlcl8xLmNyZWF0ZVJlbmRlcmVyKCgpID0+IHtcclxuICAgICAgICBhbW91bnRWYWx1ZUlucHV0LnZhbHVlID0gYmx1ckFtb3VudC50b1N0cmluZygpO1xyXG4gICAgICAgIGFtb3VudElucHV0LnZhbHVlID0gYmx1ckxvZ1NjYWxlLnRvTGluZWFyKGJsdXJBbW91bnQpLnRvU3RyaW5nKCk7XHJcbiAgICAgICAgcmVuZGVyKHByb2dyYW0sIHNjcmVlblRyaWFuZ2xlKTtcclxuICAgIH0pO1xyXG4gICAgYW1vdW50SW5wdXQub25pbnB1dCA9ICgpID0+IHtcclxuICAgICAgICAvL2NvbnZlcnQgdGhlIHNsaWRlciB2YWx1ZSBhcyBpZiBpdCB3YXMgZXhwb25lbnRpYWxcclxuICAgICAgICBibHVyQW1vdW50ID0gcGFyc2VGbG9hdChibHVyTG9nU2NhbGUuZnJvbUxpbmVhcihwYXJzZUZsb2F0KGFtb3VudElucHV0LnZhbHVlKSkudG9GaXhlZCgxKSk7XHJcbiAgICAgICAgZHJhdygpO1xyXG4gICAgfTtcclxuICAgIGFtb3VudFZhbHVlSW5wdXQub25jaGFuZ2UgPSAoKSA9PiB7XHJcbiAgICAgICAgYmx1ckFtb3VudCA9IHBhcnNlRmxvYXQoYW1vdW50VmFsdWVJbnB1dC52YWx1ZSk7XHJcbiAgICAgICAgZHJhdygpO1xyXG4gICAgfTtcclxuICAgIGRyYXcoKTtcclxufTtcclxuaWYgKGltYWdlLmNvbXBsZXRlKSB7XHJcbiAgICBzdGFydCgpO1xyXG59XHJcbmVsc2Uge1xyXG4gICAgaW1hZ2Uub25sb2FkID0gc3RhcnQ7XHJcbn1cclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5jcmVhdGVSZW5kZXJlciA9IHZvaWQgMDtcclxuY29uc3QgY3JlYXRlUmVuZGVyZXIgPSAocmVuZGVyRnVuYywgYWZ0ZXJSZW5kZXJGdW5jKSA9PiB7XHJcbiAgICBsZXQgZHJhd2luZyA9IGZhbHNlO1xyXG4gICAgcmV0dXJuICgpID0+IHtcclxuICAgICAgICBpZiAoIWRyYXdpbmcpIHtcclxuICAgICAgICAgICAgZHJhd2luZyA9IHRydWU7XHJcbiAgICAgICAgICAgIHJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICByZW5kZXJGdW5jKCk7XHJcbiAgICAgICAgICAgICAgICBkcmF3aW5nID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICBhZnRlclJlbmRlckZ1bmMgPT09IG51bGwgfHwgYWZ0ZXJSZW5kZXJGdW5jID09PSB2b2lkIDAgPyB2b2lkIDAgOiBhZnRlclJlbmRlckZ1bmMoKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgfTtcclxufTtcclxuZXhwb3J0cy5jcmVhdGVSZW5kZXJlciA9IGNyZWF0ZVJlbmRlcmVyO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLmNyZWF0ZVN1bW1lZFRleHR1cmVXZWJnbCA9IHZvaWQgMDtcclxuY29uc3QgYWRkNE11dGF0ZV8xID0gcmVxdWlyZShcIi4uL3V0aWxzL2FkZDRNdXRhdGVcIik7XHJcbmNvbnN0IHN1YnRyYWN0NE11dGF0ZV8xID0gcmVxdWlyZShcIi4uL3V0aWxzL3N1YnRyYWN0NE11dGF0ZVwiKTtcclxuLy9zaW1pbGFyIHRvIGNyZWF0ZVN1bW1lZFRleHR1cmUgZXhjZXB0IGNyZWF0ZXMgYSBzaW5nbGUgdWludDMyIGFycmF5IGFuZCBmbGlwcyB0aGUgeSBvZiB0aGUgaW1hZ2VcclxuY29uc3QgY3JlYXRlU3VtbWVkVGV4dHVyZVdlYmdsID0gKGltYWdlRGF0YSkgPT4ge1xyXG4gICAgY29uc3Qgc3VtbWVkVGV4dHVyZSA9IG5ldyBBcnJheShpbWFnZURhdGEuaGVpZ2h0KTtcclxuICAgIGZvciAobGV0IHkgPSAwOyB5IDwgaW1hZ2VEYXRhLmhlaWdodDsgeSsrKSB7XHJcbiAgICAgICAgc3VtbWVkVGV4dHVyZVt5XSA9IG5ldyBBcnJheShpbWFnZURhdGEud2lkdGgpO1xyXG4gICAgICAgIGZvciAobGV0IHggPSAwOyB4IDwgaW1hZ2VEYXRhLndpZHRoOyB4KyspIHtcclxuICAgICAgICAgICAgY29uc3QgaSA9ICgoaW1hZ2VEYXRhLmhlaWdodCAtIDEgLSB5KSAqIGltYWdlRGF0YS53aWR0aCArIHgpICogNDtcclxuICAgICAgICAgICAgY29uc3QgcGl4ID0gbmV3IFVpbnQzMkFycmF5KGltYWdlRGF0YS5kYXRhLnNsaWNlKGksIGkgKyA0KSk7XHJcbiAgICAgICAgICAgIGlmICh4ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgYWRkNE11dGF0ZV8xLmFkZDRNdXRhdGUocGl4LCBzdW1tZWRUZXh0dXJlW3ldW3ggLSAxXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHkgPiAwKSB7XHJcbiAgICAgICAgICAgICAgICBhZGQ0TXV0YXRlXzEuYWRkNE11dGF0ZShwaXgsIHN1bW1lZFRleHR1cmVbeSAtIDFdW3hdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoeCA+IDAgJiYgeSA+IDApIHtcclxuICAgICAgICAgICAgICAgIHN1YnRyYWN0NE11dGF0ZV8xLnN1YnRyYWN0NE11dGF0ZShwaXgsIHN1bW1lZFRleHR1cmVbeSAtIDFdW3ggLSAxXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgc3VtbWVkVGV4dHVyZVt5XVt4XSA9IHBpeDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBjb25zdCBzdW1tZWRJbWFnZVJhdyA9IG5ldyBVaW50MzJBcnJheShpbWFnZURhdGEud2lkdGggKiBpbWFnZURhdGEuaGVpZ2h0ICogNCk7XHJcbiAgICBmb3IgKGxldCBpID0gMCwgeSA9IGltYWdlRGF0YS5oZWlnaHQgLSAxOyB5ID49IDA7IHktLSkge1xyXG4gICAgICAgIGNvbnN0IHJvdyA9IHN1bW1lZFRleHR1cmVbeV07XHJcbiAgICAgICAgZm9yIChsZXQgeCA9IDA7IHggPCBpbWFnZURhdGEud2lkdGg7IHgrKywgaSArPSA0KSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHBpeCA9IHJvd1t4XTtcclxuICAgICAgICAgICAgc3VtbWVkSW1hZ2VSYXdbaV0gPSBwaXhbMF07XHJcbiAgICAgICAgICAgIHN1bW1lZEltYWdlUmF3W2kgKyAxXSA9IHBpeFsxXTtcclxuICAgICAgICAgICAgc3VtbWVkSW1hZ2VSYXdbaSArIDJdID0gcGl4WzJdO1xyXG4gICAgICAgICAgICBzdW1tZWRJbWFnZVJhd1tpICsgM10gPSBwaXhbM107XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcmV0dXJuIHN1bW1lZEltYWdlUmF3O1xyXG59O1xyXG5leHBvcnRzLmNyZWF0ZVN1bW1lZFRleHR1cmVXZWJnbCA9IGNyZWF0ZVN1bW1lZFRleHR1cmVXZWJnbDtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5tYWtlTG9nU2NhbGUgPSB2b2lkIDA7XHJcbmNvbnN0IG1ha2VMb2dTY2FsZSA9IChmcm9tLCB0bykgPT4ge1xyXG4gICAgY29uc3QgbWluID0gZnJvbSA/IE1hdGgubG9nKGZyb20pIDogMDtcclxuICAgIGNvbnN0IG1heCA9IE1hdGgubG9nKHRvKTtcclxuICAgIGNvbnN0IHNjYWxlID0gbWF4IC0gbWluO1xyXG4gICAgcmV0dXJuIHtcclxuICAgICAgICBmcm9tTGluZWFyOiAodmFsdWUpID0+IE1hdGguZXhwKG1pbiArIHNjYWxlICogdmFsdWUpLFxyXG4gICAgICAgIHRvTGluZWFyOiAobG9nVmFsdWUpID0+IChNYXRoLmxvZyhsb2dWYWx1ZSkgLSBtaW4pIC8gc2NhbGVcclxuICAgIH07XHJcbn07XHJcbmV4cG9ydHMubWFrZUxvZ1NjYWxlID0gbWFrZUxvZ1NjYWxlO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLmFkZDRNdXRhdGUgPSB2b2lkIDA7XHJcbmNvbnN0IGFkZDRNdXRhdGUgPSAoYSwgYikgPT4ge1xyXG4gICAgYVswXSArPSBiWzBdO1xyXG4gICAgYVsxXSArPSBiWzFdO1xyXG4gICAgYVsyXSArPSBiWzJdO1xyXG4gICAgYVszXSArPSBiWzNdO1xyXG4gICAgcmV0dXJuIGE7XHJcbn07XHJcbmV4cG9ydHMuYWRkNE11dGF0ZSA9IGFkZDRNdXRhdGU7XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMuZ2V0SW1hZ2VEYXRhID0gdm9pZCAwO1xyXG5jb25zdCBnZXRJbWFnZURhdGEgPSAoaW1hZ2UpID0+IHtcclxuICAgIGNvbnN0IGltYWdlQ2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XHJcbiAgICBpbWFnZUNhbnZhcy53aWR0aCA9IGltYWdlLndpZHRoO1xyXG4gICAgaW1hZ2VDYW52YXMuaGVpZ2h0ID0gaW1hZ2UuaGVpZ2h0O1xyXG4gICAgY29uc3QgaW1hZ2VHcmFwaGljcyA9IGltYWdlQ2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICBpZiAoIWltYWdlR3JhcGhpY3MpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBjcmVhdGUgY2FudmFzIHRvIGV4dHJhY3QgaW1hZ2UgZGF0YScpO1xyXG4gICAgfVxyXG4gICAgaW1hZ2VHcmFwaGljcy5jbGVhclJlY3QoMCwgMCwgaW1hZ2VDYW52YXMud2lkdGgsIGltYWdlQ2FudmFzLmhlaWdodCk7XHJcbiAgICBpbWFnZUdyYXBoaWNzLmRyYXdJbWFnZShpbWFnZSwgMCwgMCk7XHJcbiAgICByZXR1cm4gaW1hZ2VHcmFwaGljcy5nZXRJbWFnZURhdGEoMCwgMCwgaW1hZ2VDYW52YXMud2lkdGgsIGltYWdlQ2FudmFzLmhlaWdodCk7XHJcbn07XHJcbmV4cG9ydHMuZ2V0SW1hZ2VEYXRhID0gZ2V0SW1hZ2VEYXRhO1xyXG4iLCJcInVzZSBzdHJpY3RcIjtcclxuT2JqZWN0LmRlZmluZVByb3BlcnR5KGV4cG9ydHMsIFwiX19lc01vZHVsZVwiLCB7IHZhbHVlOiB0cnVlIH0pO1xyXG5leHBvcnRzLnN1YnRyYWN0NE11dGF0ZSA9IHZvaWQgMDtcclxuY29uc3Qgc3VidHJhY3Q0TXV0YXRlID0gKGEsIGIpID0+IHtcclxuICAgIGFbMF0gLT0gYlswXTtcclxuICAgIGFbMV0gLT0gYlsxXTtcclxuICAgIGFbMl0gLT0gYlsyXTtcclxuICAgIGFbM10gLT0gYlszXTtcclxuICAgIHJldHVybiBhO1xyXG59O1xyXG5leHBvcnRzLnN1YnRyYWN0NE11dGF0ZSA9IHN1YnRyYWN0NE11dGF0ZTtcclxuIiwiXCJ1c2Ugc3RyaWN0XCI7XHJcbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwgeyB2YWx1ZTogdHJ1ZSB9KTtcclxuZXhwb3J0cy5jcmVhdGVQcm9ncmFtID0gdm9pZCAwO1xyXG5jb25zdCBjcmVhdGVQcm9ncmFtID0gKGdsLCB2ZXJ0U2hhZGVyLCBmcmFnU2hhZGVyKSA9PiB7XHJcbiAgICBjb25zdCBwcm9ncmFtID0gZ2wuY3JlYXRlUHJvZ3JhbSgpO1xyXG4gICAgaWYgKHByb2dyYW0gPT09IG51bGwpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoJ0NvdWxkIG5vdCBjcmVhdGUgcHJvZ3JhbScpO1xyXG4gICAgfVxyXG4gICAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIHZlcnRTaGFkZXIpO1xyXG4gICAgZ2wuYXR0YWNoU2hhZGVyKHByb2dyYW0sIGZyYWdTaGFkZXIpO1xyXG4gICAgZ2wubGlua1Byb2dyYW0ocHJvZ3JhbSk7XHJcbiAgICBjb25zdCBsaW5rZWQgPSBnbC5nZXRQcm9ncmFtUGFyYW1ldGVyKHByb2dyYW0sIGdsLkxJTktfU1RBVFVTKTtcclxuICAgIGlmICghbGlua2VkKSB7XHJcbiAgICAgICAgY29uc3QgZXJyb3JNZXNzYWdlID0gZ2wuZ2V0UHJvZ3JhbUluZm9Mb2cocHJvZ3JhbSk7XHJcbiAgICAgICAgZ2wuZGVsZXRlUHJvZ3JhbShwcm9ncmFtKTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGxpbmtpbmcgcHJvZ3JhbSA6ICR7ZXJyb3JNZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHByb2dyYW07XHJcbn07XHJcbmV4cG9ydHMuY3JlYXRlUHJvZ3JhbSA9IGNyZWF0ZVByb2dyYW07XHJcbiIsIlwidXNlIHN0cmljdFwiO1xyXG5PYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgXCJfX2VzTW9kdWxlXCIsIHsgdmFsdWU6IHRydWUgfSk7XHJcbmV4cG9ydHMubG9hZFNoYWRlciA9IHZvaWQgMDtcclxuY29uc3QgbG9hZFNoYWRlciA9IChnbCwgc291cmNlLCB0eXBlKSA9PiB7XHJcbiAgICBjb25zdCBzaGFkZXIgPSBnbC5jcmVhdGVTaGFkZXIodHlwZSk7XHJcbiAgICBpZiAoc2hhZGVyID09PSBudWxsKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKCdDb3VsZCBub3QgY3JlYXRlIHNoYWRlcicpO1xyXG4gICAgfVxyXG4gICAgZ2wuc2hhZGVyU291cmNlKHNoYWRlciwgc291cmNlKTtcclxuICAgIGdsLmNvbXBpbGVTaGFkZXIoc2hhZGVyKTtcclxuICAgIGNvbnN0IGNvbXBpbGVkID0gZ2wuZ2V0U2hhZGVyUGFyYW1ldGVyKHNoYWRlciwgZ2wuQ09NUElMRV9TVEFUVVMpO1xyXG4gICAgaWYgKCFjb21waWxlZCkge1xyXG4gICAgICAgIGNvbnN0IGVycm9yTWVzc2FnZSA9IGdsLmdldFNoYWRlckluZm9Mb2coc2hhZGVyKTtcclxuICAgICAgICBnbC5kZWxldGVTaGFkZXIoc2hhZGVyKTtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoYEVycm9yIGNvbXBpbGluZyBzaGFkZXI6ICR7ZXJyb3JNZXNzYWdlfWApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHNoYWRlcjtcclxufTtcclxuZXhwb3J0cy5sb2FkU2hhZGVyID0gbG9hZFNoYWRlcjtcclxuIiwiLy8gVGhlIG1vZHVsZSBjYWNoZVxudmFyIF9fd2VicGFja19tb2R1bGVfY2FjaGVfXyA9IHt9O1xuXG4vLyBUaGUgcmVxdWlyZSBmdW5jdGlvblxuZnVuY3Rpb24gX193ZWJwYWNrX3JlcXVpcmVfXyhtb2R1bGVJZCkge1xuXHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcblx0dmFyIGNhY2hlZE1vZHVsZSA9IF9fd2VicGFja19tb2R1bGVfY2FjaGVfX1ttb2R1bGVJZF07XG5cdGlmIChjYWNoZWRNb2R1bGUgIT09IHVuZGVmaW5lZCkge1xuXHRcdHJldHVybiBjYWNoZWRNb2R1bGUuZXhwb3J0cztcblx0fVxuXHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuXHR2YXIgbW9kdWxlID0gX193ZWJwYWNrX21vZHVsZV9jYWNoZV9fW21vZHVsZUlkXSA9IHtcblx0XHQvLyBubyBtb2R1bGUuaWQgbmVlZGVkXG5cdFx0Ly8gbm8gbW9kdWxlLmxvYWRlZCBuZWVkZWRcblx0XHRleHBvcnRzOiB7fVxuXHR9O1xuXG5cdC8vIEV4ZWN1dGUgdGhlIG1vZHVsZSBmdW5jdGlvblxuXHRfX3dlYnBhY2tfbW9kdWxlc19fW21vZHVsZUlkXS5jYWxsKG1vZHVsZS5leHBvcnRzLCBtb2R1bGUsIG1vZHVsZS5leHBvcnRzLCBfX3dlYnBhY2tfcmVxdWlyZV9fKTtcblxuXHQvLyBSZXR1cm4gdGhlIGV4cG9ydHMgb2YgdGhlIG1vZHVsZVxuXHRyZXR1cm4gbW9kdWxlLmV4cG9ydHM7XG59XG5cbiIsIi8vIHN0YXJ0dXBcbi8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuLy8gVGhpcyBlbnRyeSBtb2R1bGUgaXMgcmVmZXJlbmNlZCBieSBvdGhlciBtb2R1bGVzIHNvIGl0IGNhbid0IGJlIGlubGluZWRcbnZhciBfX3dlYnBhY2tfZXhwb3J0c19fID0gX193ZWJwYWNrX3JlcXVpcmVfXyg4NTEpO1xuIl0sInNvdXJjZVJvb3QiOiIifQ==